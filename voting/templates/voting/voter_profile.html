{% extends 'voting/base.html' %}
{% load static %}

{% block content %}
<div id="voterProfileData" data-email-verified="{% if email_verified %}true{% else %}false{% endif %}" style="display: none;"></div>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      emailjs.init("{{ emailjs_public_key|default:'' }}");
   })();
</script>

<style>
    /* Enhanced CSS Variables for Consistent Theming */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        --error-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        --vote-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --glass-bg: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.18);
        --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
        --shadow-hover: 0 15px 35px rgba(31, 38, 135, 0.5);
        --border-radius: 16px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Global Enhancements */
    * {
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        position: relative;
        overflow-x: hidden;
    }

    /* Floating Particles Background */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 2px, transparent 2px),
            radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
            radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
        background-size: 50px 50px, 30px 30px, 70px 70px;
        animation: float 20s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-10px) rotate(1deg); }
        66% { transform: translateY(5px) rotate(-1deg); }
    }

    /* Enhanced Status Messages */
    .status-message {
        padding: 1.2rem 2rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        animation: statusSlideIn 0.5s ease-out;
    }

    @keyframes statusSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .status-success {
        background: linear-gradient(135deg, rgba(72, 187, 120, 0.9), rgba(56, 239, 125, 0.9));
        color: white;
    }

    .status-error {
        background: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(238, 90, 82, 0.9));
        color: white;
    }

    .status-warning {
        background: linear-gradient(135deg, rgba(250, 112, 154, 0.9), rgba(254, 225, 64, 0.9));
        color: white;
    }

    .status-info {
        background: linear-gradient(135deg, rgba(79, 172, 254, 0.9), rgba(0, 242, 254, 0.9));
        color: white;
    }

    .status-message::before {
        content: '';
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.8);
        margin-right: 1rem;
        animation: pulse 2s ease-in-out infinite;
    }

    .voter-profile-container {
        max-width: 950px;
        margin: 2rem auto;
        padding: 0 1rem;
        position: relative;
    }

    /* Enhanced Glass Morphism Card */
    .voter-details-card {
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-radius: var(--border-radius);
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-light);
        padding: 2.5rem;
        margin-bottom: 2rem;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .voter-details-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .voter-details-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
    }
    
    .profile-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2.5rem;
        position: relative;
    }
    
    .voter-details {
        flex: 1;
    }

    /* Enhanced Profile Photo */
    .voter-photo {
        width: 140px;
        height: 140px;
        border-radius: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 2rem;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .voter-photo:hover {
        transform: scale(1.05);
        border-color: rgba(255, 255, 255, 0.5);
    }
    
    .voter-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 17px;
        transition: var(--transition);
    }
    
    .voter-photo img.loading {
        opacity: 1;
        filter: none;
    }
    
    .voter-photo-placeholder {
        color: rgba(255, 255, 255, 0.7);
        font-size: 2.5rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    /* Enhanced Detail Rows */
    .detail-row {
        display: flex;
        margin-bottom: 1.2rem;
        align-items: center;
        padding: 0.8rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
    }

    .detail-row:hover {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .detail-label {
        font-weight: 700;
        color: rgba(255, 255, 255, 0.9);
        width: 160px;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        display: flex;
        align-items: center;
    }

    .detail-label::before {
        content: '';
        width: 6px;
        height: 6px;
        background: var(--vote-gradient);
        border-radius: 50%;
        margin-right: 10px;
        box-shadow: 0 0 10px rgba(56, 239, 125, 0.5);
    }
    
    .detail-value {
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* Enhanced Email Verification Section */
    .email-verification-section {
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        color: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-light);
    }

    .email-verification-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--primary-gradient);
        opacity: 0.8;
        z-index: -1;
    }

    .email-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .email-address {
        font-size: 1.3rem;
        font-weight: 700;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.8rem 1.5rem;
        border-radius: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .email-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    /* Enhanced Button Styles */
    .btn-email {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 0.8rem 2rem;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.95rem;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
    }

    .btn-email::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.6s ease;
    }

    .btn-email:hover::before {
        left: 100%;
    }

    .btn-email:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .btn-success {
        background: var(--success-gradient);
        border: none;
        color: white;
        padding: 0.8rem 2rem;
        border-radius: 25px;
        font-weight: 600;
        transition: var(--transition);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    }

    .btn-success:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.6);
    }

    /* Enhanced Verification Message */
    .verification-message {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1.5rem 0;
        text-align: center;
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .selected-candidate-section {
        margin-bottom: 2rem;
    }
    
    .selected-candidate-section .card {
        background: var(--success-gradient);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-light);
        transition: var(--transition);
    }

    .selected-candidate-section .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-hover);
    }
    
    .email-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .email-address {
        font-size: 1.2rem;
        font-weight: 600;
        color: white;
    }
    
    .email-buttons {
        display: flex;
        gap: 1rem;
    }
    
    .btn-email {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-email:hover {
        background: rgba(255, 255, 255, 0.3);
        color: white;
        transform: translateY(-1px);
    }
    
    .verification-message {
        margin: 1rem 0;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .vote-section {
        text-align: center;
        margin-top: 2rem;
    }
    
    .btn-vote-now {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        border: none;
        color: white;
        padding: 1rem 3rem;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
    }
    
    .btn-vote-now:hover {
        background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(72, 187, 120, 0.4);
        color: white;
    }
    
    .btn-vote-now:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .otp-verification-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
    }
    
    .otp-verification-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .otp-modal-content {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        position: relative;
    }
    
    .otp-header h4 {
        color: #1f2937;
        font-weight: 700;
    }
    
    .otp-input-section {
        margin: 1.5rem 0;
    }
    
    .otp-input-section .form-label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
        text-align: left;
    }
    
    .otp-input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        text-align: center;
        font-size: 1.2rem;
        letter-spacing: 0.2em;
        font-weight: 600;
        transition: border-color 0.3s ease;
    }
    
    .otp-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .otp-buttons {
        display: flex;
        gap: 0.5rem;
        margin: 1.5rem 0;
    }
    
    .btn-verify {
        flex: 2;
        padding: 0.75rem 1rem;
        font-weight: 600;
    }
    
    .otp-resend-section {
        margin: 1rem 0;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .resend-timer {
        font-size: 0.9rem;
        color: #6b7280;
        margin-bottom: 0.5rem;
    }
    
    .countdown {
        font-weight: 600;
        color: #ef4444;
    }
    
    .btn-resend {
        background: none;
        border: none;
        color: #667eea;
        font-weight: 500;
        text-decoration: underline;
        cursor: pointer;
        padding: 0.5rem;
    }
    
    .btn-resend:hover {
        color: #5a67d8;
        text-decoration: none;
    }
    
    .btn-resend:disabled {
        color: #9ca3af;
        cursor: not-allowed;
        text-decoration: none;
    }
    
    .otp-help {
        margin-top: 1rem;
        padding: 1rem;
        background: #eff6ff;
        border-radius: 8px;
        border-left: 4px solid #3b82f6;
    }
    
    .status-message {
        margin: 1rem 0;
        padding: 0.75rem;
        border-radius: 6px;
        display: none;
    }
    
    .status-success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }
    
    .status-error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }
    
    .status-warning {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
    }
    
    /* Candidate Profiles Section */
    .candidates-section {
        margin: 2rem 0;
    }
    
    .section-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: var(--transition);
    }

    .modal.show {
        opacity: 1;
    }

    .candidate-modal-content {
        max-width: 95vw;
        max-height: 90vh;
        width: 1500px;
        overflow-y: auto;
        background: var(--glass-bg);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        animation: modalZoomIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    @keyframes modalZoomIn {
        from {
            opacity: 0;
            transform: scale(0.7) translateY(-50px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    .modal-header {
        background: var(--primary-gradient);
        color: white;
        padding: 2.5rem;
        border-radius: 24px 24px 0 0;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .modal-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .modal-header h2 {
        margin: 0;
        font-size: 2.2rem;
        font-weight: 700;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 2;
    }

    .modal-header p {
        margin: 1rem 0 0;
        font-size: 1.1rem;
        opacity: 0.9;
        position: relative;
        z-index: 2;
    }

    .modal-header .close-btn {
        position: absolute;
        top: 1.5rem;
        right: 2rem;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .modal-header .close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }

    .modal-body {
        padding: 2rem;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }

    .modal-body p {
        text-align: center;
        font-size: 1.1rem;
        color: #4a5568;
        margin-bottom: 2rem;
        padding: 1rem;
        background: white;
        border-radius: 12px;
        border-left: 4px solid #667eea;
    }

    .candidates-grid-modal {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    /* Enhanced Candidate Card Modal */
    .candidate-card-modal {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 2px solid var(--glass-border);
        border-radius: 20px;
        padding: 0;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        transform-origin: center;
    }

    .candidate-card-modal::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        opacity: 0;
        transition: var(--transition);
        z-index: 1;
    }

    .candidate-card-modal:hover {
        border-color: rgba(102, 126, 234, 0.6);
        transform: translateY(-8px) scale(1.03);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
    }

    .candidate-card-modal:hover::before {
        opacity: 1;
    }

    .candidate-card-modal.selected {
        border-color: rgba(17, 153, 142, 0.8);
        background: linear-gradient(145deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.05));
        box-shadow: 0 25px 50px rgba(17, 153, 142, 0.4);
        transform: translateY(-8px) scale(1.05);
        animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
        0%, 100% { 
            box-shadow: 0 25px 50px rgba(17, 153, 142, 0.4), 0 0 0 0 rgba(17, 153, 142, 0.3);
        }
        50% { 
            box-shadow: 0 25px 50px rgba(17, 153, 142, 0.4), 0 0 0 10px rgba(17, 153, 142, 0.1);
        }
    }

    .candidate-header {
        background: var(--primary-gradient);
        color: white;
        padding: 2rem 1.5rem;
        text-align: center;
        position: relative;
        z-index: 2;
        overflow: hidden;
    }

    .candidate-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.8s ease;
    }

    .candidate-card-modal:hover .candidate-header::before {
        left: 100%;
    }

    .party-symbol {
        width: 90px;
        height: 90px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        margin: 0 auto 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 3px solid rgba(255, 255, 255, 0.8);
    }

    .party-symbol img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border-radius: 50%;
        display: block;
    }

    .party-symbol i {
        font-size: 2.5rem;
        color: #667eea;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .party-symbol .fallback-icon {
        width: 60px;
        height: 60px;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #667eea;
    }

    .symbol-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        font-weight: 700;
    }

    .symbol-placeholder i {
        font-size: 1.2rem;
        margin-bottom: 2px;
        color: white;
    }

    .symbol-placeholder span {
        font-size: 1rem;
        font-weight: 700;
        color: white;
    }

    .party-info {
        text-align: center;
    }

    .party-name {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .candidate-name {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        opacity: 0.95;
    }

    .party-description {
        font-size: 0.9rem;
        opacity: 0.9;
        margin: 0;
        font-style: italic;
    }

    .candidate-details {
        padding: 1.5rem;
        background: white;
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .detail-item:last-child {
        border-bottom: none;
    }

    .detail-label {
        font-weight: 600;
        color: #4a5568;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .detail-label i {
        color: #667eea;
        font-size: 1rem;
        width: 16px;
        text-align: center;
    }

    .detail-label::before {
        display: none;
    }

    .detail-value {
        font-weight: 500;
        color: #2d3748;
        text-align: right;
        max-width: 60%;
    }

    .selection-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(72, 187, 120, 0.95) 0%, rgba(56, 161, 105, 0.95) 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        backdrop-filter: blur(2px);
    }

    .selection-overlay i {
        font-size: 3rem;
        margin-bottom: 1rem;
        animation: pulse 2s infinite;
    }

    .selection-overlay span {
        font-size: 1.2rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .candidate-card-modal:hover .selection-overlay {
        opacity: 1;
    }

    .candidate-card-modal.selected .selection-overlay {
        opacity: 1;
        background: linear-gradient(135deg, rgba(72, 187, 120, 0.9) 0%, rgba(56, 161, 105, 0.9) 100%);
    }

    .modal-footer {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 1.5rem 2rem;
        border-radius: 0 0 20px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top: 1px solid #e2e8f0;
    }

    .modal-footer .btn {
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 12px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .modal-footer .btn-secondary {
        background: #6c757d;
        border: none;
        color: white;
    }

    .modal-footer .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    .modal-footer .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .modal-footer .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    /* Vote Button Styling */
    .modal-footer .btn-success {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        border: none;
        color: white;
        font-weight: 600;
        font-size: 1.1em;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        transition: all 0.3s ease;
        min-width: 150px;
    }

    .modal-footer .btn-success:hover {
        background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .modal-footer .btn-success:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .modal-footer .btn-success:disabled:hover {
        background: #9ca3af;
        transform: none;
        box-shadow: none;
    }

    /* Enhanced Animation Keyframes */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .candidate-card-modal {
        animation: fadeInUp 0.6s ease-out;
    }

    /* Base Modal Styles - Enhanced Positioning */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        margin: auto;
        position: relative;
        animation: slideInDown 0.4s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-100px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Responsive Design Enhancements */
    @media (max-width: 1200px) {
        .candidates-grid-modal {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
        
        .candidate-modal-content {
            width: 95vw;
            max-width: 1100px;
        }
    }

    @media (max-width: 768px) {
        .candidates-grid-modal {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .candidate-modal-content {
            width: 95vw;
            max-height: 90vh;
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
        }
        
        .party-symbol {
            width: 60px;
            height: 60px;
        }
        
        .party-symbol img {
            width: 45px;
            height: 45px;
        }
    }

    /* Vote Button Styling */
    .modal-footer .btn-success {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        border: none;
        color: white;
        font-weight: 600;
        font-size: 1.1em;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        transition: all 0.3s ease;
        min-width: 150px;
    }

    .modal-footer .btn-success:hover {
        background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .modal-footer .btn-success:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .modal-footer .btn-success:disabled:hover {
        background: #9ca3af;
        transform: none;
        box-shadow: none;
    }

    .candidate-card-modal.selected .selection-overlay {
        opacity: 1;
        background: rgba(72, 187, 120, 0.9);
    }

    .selection-overlay i {
        font-size: 3rem;
        margin-bottom: 0.5rem;
    }

    .modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-top: 1px solid #e2e8f0;
        background: #f8fafc;
    }

    @media (max-width: 768px) {
        .candidate-modal-content {
            width: 95vw;
            margin: 20px auto;
        }
        
        .candidates-grid-modal {
            grid-template-columns: 1fr;
        }
    }

    /* Voting Section Styles */
    .voting-section {
        background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
        border: 2px solid #48bb78;
        border-radius: 16px;
        padding: 2rem;
        margin-top: 2rem;
        text-align: center;
    }

    .selected-candidate-info {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .selected-candidate-display {
        font-size: 1.2rem;
        font-weight: 600;
        color: #1f2937;
        margin-top: 1rem;
    }

    .voting-actions {
        margin: 2rem 0;
    }

    .voting-actions .btn {
        margin: 0.5rem;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .voting-actions .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Enhanced Vote Button Section Styles */
    .vote-button-section {
        text-align: center;
        margin: 3rem 0;
        padding: 3rem;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-light);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
    }

    .vote-button-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--vote-gradient);
        opacity: 0.9;
        z-index: -1;
    }

    .vote-button-section::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.8s ease;
        z-index: 1;
    }

    .vote-button-section:hover::after {
        left: 100%;
    }

    .vote-button-section:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(17, 153, 142, 0.4);
    }

    .btn-vote-primary {
        background: rgba(255, 255, 255, 0.95);
        color: #11998e;
        border: 3px solid rgba(255, 255, 255, 0.3);
        padding: 1.5rem 4rem;
        font-size: 1.4rem;
        font-weight: 700;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 8px 30px rgba(255, 255, 255, 0.3);
        position: relative;
        z-index: 2;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .btn-vote-primary:hover {
        background: white;
        color: #0d7377;
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 40px rgba(255, 255, 255, 0.5);
        border-color: rgba(255, 255, 255, 0.6);
    }

    .btn-vote-primary:active {
        transform: translateY(-3px) scale(1.02);
    }

    /* Enhanced Animations */
    @keyframes pulse {
        0% { transform: scale(1); box-shadow: 0 8px 30px rgba(255, 255, 255, 0.3); }
        50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(255, 255, 255, 0.5); }
        100% { transform: scale(1); box-shadow: 0 8px 30px rgba(255, 255, 255, 0.3); }
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.8);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    @keyframes glow {
        0%, 100% { box-shadow: 0 0 20px rgba(17, 153, 142, 0.3); }
        50% { box-shadow: 0 0 40px rgba(17, 153, 142, 0.6), 0 0 60px rgba(17, 153, 142, 0.4); }
    }

    .vote-button-section.show {
        animation: slideInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1), glow 3s ease-in-out 2s;
    }

    .vote-help-text {
        margin-top: 2rem;
        color: rgba(255, 255, 255, 0.9);
    }

    .vote-help-text .fas {
        color: rgba(255, 255, 255, 0.8);
    }

    /* Candidates Section Styling */
    .candidates-section {
        margin-top: 2rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .candidates-header h2 {
        color: white;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .candidates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
    }

    .candidate-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        border: 2px solid transparent;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .candidate-card:hover {
        transform: translateY(-5px);
        border-color: #667eea;
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
    }

    .candidate-card.selected {
        border-color: #10b981;
        background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
    }

    .candidate-header {
        padding: 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: relative;
        overflow: hidden;
    }

    .candidate-card.selected .candidate-header {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .detail-value {
        font-weight: 600;
        color: #374151;
    }

    .selection-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(16, 185, 129, 0.9);
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: white;
        font-weight: 600;
        font-size: 1.2rem;
    }

    .candidate-card.selected .selection-overlay {
        display: flex;
    }

    .selection-overlay i {
        font-size: 3rem;
        margin-bottom: 0.5rem;
    }

    #voteButton {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border: none;
        padding: 15px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 50px;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        transition: all 0.3s ease;
    }

    #voteButton:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }

    /* Confirmation Modal Styles */
    .confirmation-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .confirmation-modal.show {
        opacity: 1;
        visibility: visible;
    }

    .confirmation-modal-content {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid var(--glass-border);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        padding: 2.5rem;
        max-width: 500px;
        width: 90%;
        text-align: center;
        transform: scale(0.8) translateY(-20px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .confirmation-modal.show .confirmation-modal-content {
        transform: scale(1) translateY(0);
    }

    .confirmation-modal-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--vote-gradient);
        border-radius: 20px 20px 0 0;
    }

    .confirmation-icon {
        font-size: 4rem;
        color: #f59e0b;
        margin-bottom: 1.5rem;
        animation: pulse 2s ease-in-out infinite;
    }

    .confirmation-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        margin-bottom: 1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .confirmation-message {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2rem;
        line-height: 1.6;
    }

    .confirmation-candidate {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1rem;
        margin: 1.5rem 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .confirmation-candidate-name {
        font-size: 1.3rem;
        font-weight: 600;
        color: white;
        margin-bottom: 0.5rem;
    }

    .confirmation-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .confirmation-btn {
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .confirmation-btn-yes {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .confirmation-btn-yes:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }

    .confirmation-btn-no {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
    }

    .confirmation-btn-no:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(239, 68, 68, 0.4);
    }

    .confirmation-warning {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        padding: 0.8rem;
        margin: 1rem 0;
        color: #fef2f2;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .confirmation-warning i {
        color: #f87171;
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }

    /* Candidate Selection Popup Styles */
    .candidate-selection-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .candidate-selection-popup.show {
        opacity: 1;
        visibility: visible;
    }

    .candidate-selection-popup-content {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 2.5rem;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.3);
        max-width: 500px;
        width: 90%;
        transform: scale(0.8);
        transition: transform 0.3s ease;
    }

    .candidate-selection-popup.show .candidate-selection-popup-content {
        transform: scale(1);
    }

    .popup-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 1rem;
        animation: bounce 1s ease-in-out;
    }

    .popup-title {
        color: #1f2937;
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .popup-message {
        color: #6b7280;
        font-size: 1.1rem;
        margin-bottom: 1rem;
    }

    .popup-candidate-name {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-size: 1.3rem;
        font-weight: 600;
        margin: 1.5rem 0;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .popup-instruction {
        color: #374151;
        font-size: 1rem;
        margin-bottom: 2rem;
    }

    .popup-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .popup-btn {
        padding: 0.8rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .popup-btn-ok {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .popup-btn-ok:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }

    .popup-btn-select {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .popup-btn-select:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }

    .popup-btn-cancel {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
    }

    .popup-btn-cancel:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(239, 68, 68, 0.4);
    }

    /* Vote Success Modal Styles */
    .vote-success-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .vote-success-modal.show {
        opacity: 1;
        visibility: visible;
    }

    .vote-success-modal-content {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
        backdrop-filter: blur(25px);
        border-radius: 24px;
        padding: 3rem;
        text-align: center;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.3);
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        transform: scale(0.8) translateY(50px);
        transition: transform 0.4s ease;
    }

    .vote-success-modal.show .vote-success-modal-content {
        transform: scale(1) translateY(0);
    }

    .success-icon {
        font-size: 5rem;
        color: #10b981;
        margin-bottom: 1.5rem;
        animation: successPulse 2s ease-in-out infinite;
    }

    @keyframes successPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .success-title {
        color: #1f2937;
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .voted-candidate {
        margin-bottom: 2rem;
    }

    .success-message {
        color: #6b7280;
        font-size: 1.2rem;
        margin-bottom: 1rem;
    }

    .candidate-name-display {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 1.2rem 2rem;
        border-radius: 16px;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 1rem 0;
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.3);
    }

    .blockchain-details {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 16px;
        padding: 1.5rem;
        margin: 2rem 0;
        text-align: left;
    }

    .blockchain-title {
        color: #059669;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }

    .blockchain-hash {
        margin-bottom: 1rem;
    }

    .blockchain-hash strong {
        color: #374151;
        display: block;
        margin-bottom: 0.5rem;
    }

    .hash-value {
        background: rgba(0, 0, 0, 0.05);
        padding: 0.8rem;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        word-break: break-all;
        color: #1f2937;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .blockchain-status {
        color: #059669;
        font-size: 0.95rem;
        font-style: italic;
    }

    .success-features {
        display: flex;
        justify-content: space-around;
        margin: 2rem 0;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .feature-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        color: #374151;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .feature-item i {
        font-size: 2rem;
        color: #10b981;
    }

    .success-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    .success-btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .success-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
    }

    .success-btn.secondary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .success-btn.secondary:hover {
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }

    /* Candidates Popup Styles */
    .candidates-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .candidates-popup.show {
        opacity: 1;
        visibility: visible;
    }

    .candidates-popup-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
    }

    .candidates-popup-container {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
        backdrop-filter: blur(25px);
        border-radius: 24px;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.3);
        max-width: 1200px;
        width: 100%;
        max-height: 90vh;
        overflow: hidden;
        transform: scale(0.8) translateY(50px);
        transition: transform 0.4s ease;
        position: relative;
    }

    .candidates-popup.show .candidates-popup-container {
        transform: scale(1) translateY(0);
    }

    .candidates-popup-header {
        background: var(--primary-gradient);
        color: white;
        padding: 2rem;
        text-align: center;
        position: relative;
    }

    .popup-close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .popup-close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }

    .popup-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .popup-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
    }

    .candidates-popup-content {
        padding: 2rem;
        overflow-y: auto;
        max-height: calc(90vh - 140px);
    }

    .candidates-grid-popup {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .candidate-card-popup {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .candidate-card-popup:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 15px 45px rgba(0, 0, 0, 0.2);
        border-color: rgba(102, 126, 234, 0.5);
    }

    .candidate-card-popup.selected {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
        border-color: rgba(102, 126, 234, 0.8);
        color: white;
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 20px 50px rgba(102, 126, 234, 0.4);
    }

    .candidate-header-popup {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .party-symbol-popup {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .party-symbol-popup img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }

    .symbol-placeholder-popup {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
        font-weight: 600;
        text-align: center;
    }

    .symbol-placeholder-popup i {
        font-size: 1.5rem;
        margin-bottom: 0.2rem;
    }

    .party-info-popup {
        flex: 1;
    }

    .party-info-popup .party-name {
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: inherit;
    }

    .party-info-popup .candidate-name {
        font-size: 1rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
        color: inherit;
    }

    .party-info-popup .party-description {
        font-size: 0.9rem;
        opacity: 0.8;
        line-height: 1.4;
        margin: 0;
        color: inherit;
    }

    .candidate-details-popup {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.8rem;
        margin-top: 1rem;
    }

    .detail-item-popup {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .detail-label-popup {
        font-size: 0.8rem;
        opacity: 0.8;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        color: inherit;
    }

    .detail-value-popup {
        font-size: 0.9rem;
        font-weight: 600;
        color: inherit;
    }

    .selection-overlay-popup {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9));
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        font-weight: 700;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        border-radius: 20px;
    }

    .selection-overlay-popup i {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        animation: pulse 2s ease-in-out infinite;
    }

    .candidate-card-popup.selected .selection-overlay-popup {
        opacity: 1;
        visibility: visible;
    }

    .candidate-hover-effect {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
        color: white;
        padding: 0.8rem;
        text-align: center;
        font-weight: 600;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        border-radius: 0 0 20px 20px;
    }

    .candidate-card-popup:hover .candidate-hover-effect {
        transform: translateY(0);
    }

    .candidate-card-popup.selected .candidate-hover-effect {
        transform: translateY(100%);
    }

    .popup-vote-section {
        text-align: center;
        padding-top: 1rem;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .popup-vote-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        padding: 1rem 3rem;
        font-size: 1.1rem;
        font-weight: 700;
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .popup-vote-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
        background: linear-gradient(135deg, #059669, #047857);
    }

    .no-candidates-popup {
        grid-column: 1 / -1;
        text-align: center;
        padding: 3rem;
        color: #6b7280;
    }

    /* Responsive Design for Popup */
    @media (max-width: 768px) {
        .candidates-popup-backdrop {
            padding: 1rem;
        }
        
        .candidates-grid-popup {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .candidate-card-popup {
            padding: 1rem;
        }
        
        .popup-title {
            font-size: 1.5rem;
        }
        
        .candidates-popup-content {
            padding: 1rem;
        }
        
        .candidate-details-popup {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
    }
</style>

<div class="voter-profile-container">
    <!-- Page Header -->
    <div class="text-center mb-4">
        <h1 class="text-primary mb-2">
            <i class="fas fa-user-check me-2"></i>
            Voter Profile Verified
        </h1>
        <p class="text-muted">Review your details and proceed to vote</p>
    </div>

    <!-- Voter Details Card -->
    <div class="voter-details-card">
        <div class="profile-header">
            <div class="voter-details">
                <div class="detail-row">
                    <span class="detail-label">Aadhaar No.:</span>
                    <span class="detail-value">{{ voter.aadhaar_number }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value">{{ voter.full_name }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">DOB:</span>
                    <span class="detail-value">{{ voter.date_of_birth|date:"M j, Y" }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Age:</span>
                    <span class="detail-value">{{ voter_age }} years</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Constituency:</span>
                    <span class="detail-value">{{ voter.constituency }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Region:</span>
                    <span class="detail-value">{{ voter.region }}</span>
                </div>
            </div>
            <div class="voter-photo">
                <!-- Debug info -->
                <div style="display: none;">
                    Voter: {{ voter.full_name }}<br>
                    Picture Name: {{ voter.profile_picture_name }}<br>
                    Has Data: {{ voter.profile_picture_data|yesno:"Yes,No" }}<br>
                    Content Type: {{ voter.profile_picture_content_type }}<br>
                    Base64 Method: {{ voter.profile_picture_url|yesno:"Available,Not Available" }}<br>
                </div>
                
                {% if voter.profile_picture_url %}
                    <!-- Display using the base64 URL property -->
                    <img src="{{ voter.profile_picture_url }}" 
                         alt="Profile Picture"
                         title="From Database: {{ voter.full_name }}"
                         onerror="console.log('Base64 failed for {{ voter.full_name }}'); this.style.display='none'; this.nextElementSibling.style.display='block';">
                {% elif voter.profile_picture_data and voter.profile_picture_content_type %}
                    <!-- Fallback with manual base64 construction -->
                    <img src="data:{{ voter.profile_picture_content_type }};base64,{{ voter.profile_picture_base64 }}" 
                         alt="Profile Picture"
                         title="Manual Base64: {{ voter.full_name }}"
                         onerror="console.log('Manual base64 failed for {{ voter.full_name }}'); this.style.display='none'; this.nextElementSibling.style.display='block';">
                {% elif voter.profile_picture_name %}
                    <!-- Display from media file if filename is stored -->
                    <img src="{{ MEDIA_URL }}profile_pictures/{{ voter.profile_picture_name }}" 
                         alt="Profile Picture"
                         title="From File: {{ voter.profile_picture_name }}"
                         onerror="console.log('File failed for {{ voter.profile_picture_name }}'); this.style.display='none'; this.nextElementSibling.style.display='block';">
                {% else %}
                    <!-- Default placeholder -->
                    <i class="fas fa-user voter-photo-placeholder"></i>
                {% endif %}
                
                <!-- Fallback placeholder (hidden by default, shown on error) -->
                <i class="fas fa-user voter-photo-placeholder" style="display: none;" title="Default Avatar"></i>
            </div>
        </div>
    </div>

    <!-- Email Verification Section -->
    <div class="email-verification-section">
        <div class="email-info">
            <div>
                <div style="font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.9;">Associated Email ID:</div>
                <div class="email-address">{{ voter.email }}</div>
                <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.8;">
                    (Verification code will be sent to this email for candidate selection)
                </div>
            </div>
            <div class="email-buttons">
                <button type="button" class="btn btn-email" onclick="changeEmail()">
                    Change
                </button>
                <button type="button" class="btn btn-success" onclick="showOTPModal()" style="margin-left: 10px;">
                    Enter OTP
                </button>
            </div>
        </div>
        
        <div class="verification-message" id="verificationMessage">
            <div style="color: #d97706; font-weight: 600;">
                <i class="fas fa-shield-alt me-2"></i>
                For security, OTP verification is required each time you access the voting page.
            </div>
        </div>
        

    </div>

    <!-- Status Messages -->
    <div id="statusMessage" class="status-message"></div>



    <!-- Candidate Profiles Section -->
    <div class="candidates-section candidates-popup" id="candidatesSection" style="display: none;">
        <div class="candidates-popup-backdrop">
            <div class="candidates-popup-container">
                <div class="candidates-popup-header">
                    <h2 class="popup-title">
                        <i class="fas fa-users text-primary me-2"></i>
                        Select Your Candidate
                    </h2>
                    <p class="popup-subtitle">
                        Choose from the following candidates to cast your vote
                    </p>
                    <button class="popup-close-btn" onclick="hideCandidatesPopup()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="candidates-popup-content">
                    <div class="candidates-grid-popup">
                        {% for party in parties %}
                        <div class="candidate-card-popup" data-party-id="{{ party.party_id }}" onclick="selectCandidate('{{ party.party_id }}', this)">
                            <div class="candidate-header-popup">
                                <div class="party-symbol-popup">
                                    {% if party.party_symbol_data and party.party_symbol_content_type %}
                                        <img src="data:{{ party.party_symbol_content_type }};base64,{{ party.party_symbol_base64 }}" 
                                             alt="{{ party.party_name }} Symbol"
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div class="symbol-placeholder-popup" style="display: none;">
                                            <i class="fas fa-flag"></i>
                                            <span>{{ party.party_id }}</span>
                                        </div>
                                    {% else %}
                                        <div class="symbol-placeholder-popup">
                                            <i class="fas fa-flag"></i>
                                            <span>{{ party.party_id }}</span>
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="party-info-popup">
                                    <h3 class="party-name">{{ party.party_name }}</h3>
                                    <p class="candidate-name">
                                        <i class="fas fa-user me-1"></i>
                                        {{ party.party_leader }}
                                    </p>
                                    <p class="party-description">{{ party.party_description|truncatewords:10 }}</p>
                                </div>
                            </div>
                            
                            <div class="candidate-details-popup">
                                <div class="detail-item-popup">
                                    <span class="detail-label-popup">
                                        <i class="fas fa-id-card"></i>
                                        Party ID
                                    </span>
                                    <span class="detail-value-popup">{{ party.party_id }}</span>
                                </div>
                                <div class="detail-item-popup">
                                    <span class="detail-label-popup">
                                        <i class="fas fa-calendar"></i>
                                        Established
                                    </span>
                                    <span class="detail-value-popup">{{ party.created_at|date:"Y" }}</span>
                                </div>
                                <div class="detail-item-popup">
                                    <span class="detail-label-popup">
                                        <i class="fas fa-chart-bar"></i>
                                        Status
                                    </span>
                                    <span class="detail-value-popup">
                                        {% if party.is_active %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactive</span>
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="selection-overlay-popup">
                                <i class="fas fa-check-circle"></i>
                                <span>Selected</span>
                            </div>
                            
                            <div class="candidate-hover-effect">
                                <div class="hover-text">Click to Select</div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="no-candidates-popup">
                            <div class="text-center py-5">
                                <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                                <h4 class="mt-3">No Candidates Available</h4>
                                <p class="text-muted">There are currently no active candidates for this election.</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Vote Button in Popup -->
                    <div class="popup-vote-section">
                        <button type="button" id="voteButton" class="btn btn-success btn-lg popup-vote-btn" onclick="submitVote()" style="display: none;">
                            <i class="fas fa-vote-yea me-2"></i>
                            Submit Vote
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Candidate and Voting Section -->
    <div class="voting-section" id="votingSection" style="display: none;">
        <div class="selected-candidate-info">
            <h3 class="text-center mb-3">
                <i class="fas fa-check-circle text-success me-2"></i>
                Selected Candidate
            </h3>
            <div class="selected-candidate-display" id="selectedCandidateDisplay">
                <!-- Selected candidate info will be displayed here -->
            </div>
        </div>
        
        <div class="voting-actions text-center">
            <button type="button" class="btn btn-warning me-3" onclick="showCandidateModal()">
                <i class="fas fa-edit me-2"></i>
                Change Selection
            </button>
            <button type="button" class="btn btn-success btn-lg" onclick="proceedToVote()">
                <i class="fas fa-vote-yea me-2"></i>
                Cast Your Vote
            </button>
        </div>
        
        <div class="mt-3 text-center">
            <small class="text-muted">
                <i class="fas fa-shield-alt me-1"></i>
                Your vote is secure and anonymous
            </small>
        </div>
    </div>

<!-- OTP Verification Modal -->
<div id="otpModal" class="otp-verification-modal">
    <div class="otp-modal-content">
        <div class="otp-header">
            <h4 class="mb-2">
                <i class="fas fa-key text-primary me-2"></i>
                Email Verification Required
            </h4>
            <p class="text-muted mb-3">
                We've sent a 6-digit verification code to your email: <strong>{{ voter.email }}</strong>
                <br>Please enter the code below to proceed with candidate selection.
            </p>
        </div>
        
        <div class="otp-input-section">
            <label for="otpInput" class="form-label">Verification Code:</label>
            <input type="text" id="otpInput" class="otp-input" 
                   placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}"
                   autocomplete="one-time-code">
        </div>
        
        <div class="otp-buttons">
            <button type="button" class="btn btn-primary btn-verify" onclick="verifyOTP()" id="verifyOtpBtn">
                <i class="fas fa-check me-1"></i>
                Verify Code
            </button>
            <button type="button" class="btn btn-secondary" onclick="closeOTPModal()">
                <i class="fas fa-times me-1"></i>
                Cancel
            </button>
        </div>
        
        <div id="otpStatusMessage" class="status-message"></div>
        
        <div class="otp-resend-section">
            <div class="resend-timer" id="resendTimer" style="display: none;">
                You can resend the code in <span id="countdown">60</span> seconds
            </div>
            <button type="button" class="btn btn-link btn-resend" id="resendOtpBtn" onclick="resendOTP()">
                <i class="fas fa-redo me-1"></i>
                Didn't receive the code? Resend OTP
            </button>
        </div>
        
        <div class="otp-help">
            <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                The verification code will expire in 15 minutes.
                <br>Check your spam folder if you don't see the email.
            </small>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="confirmation-modal">
    <div class="confirmation-modal-content">
        <div class="confirmation-icon">
            <i class="fas fa-vote-yea"></i>
        </div>
        <h3 class="confirmation-title">Confirm Your Vote</h3>
        <p class="confirmation-message">
            Are you sure you want to vote for this candidate? This action cannot be undone.
        </p>
        
        <div class="confirmation-candidate">
            <div class="confirmation-candidate-name" id="selectedCandidateName">
                <!-- Selected candidate name will be inserted here -->
            </div>
        </div>
        
        <div class="confirmation-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Once submitted, your vote is permanently recorded on the blockchain</span>
        </div>
        
        <div class="confirmation-buttons">
            <button class="confirmation-btn confirmation-btn-yes" onclick="confirmVote()">
                <i class="fas fa-check me-2"></i>Yes, Cast My Vote
            </button>
            <button class="confirmation-btn confirmation-btn-no" onclick="cancelVote()">
                <i class="fas fa-times me-2"></i>Cancel
            </button>
        </div>
    </div>
</div>


<script>
let otpSent = false;
let emailVerified = false;
let emailVerifiedInDatabase = false;
let resendCountdown = 0;
let resendTimer = null;

document.addEventListener('DOMContentLoaded', function() {
    // Get email verification status from page data (but don't trust it for security)
    const dataEl = document.getElementById('voterProfileData');
    emailVerifiedInDatabase = dataEl.dataset.emailVerified === 'true';
    
    // Check if email is already verified in database
    if (emailVerifiedInDatabase) {
        emailVerified = true;
        console.log(' Email already verified - OTP verification completed');
    } else {
        emailVerified = false;
        console.log(' Email not verified - OTP verification required');
    }
    
    // OTP will be sent only when user clicks "Send OTP" button
    
    // Update verification message based on email verification status
    if (emailVerifiedInDatabase) {
        document.getElementById('verificationMessage').innerHTML = 
            '<div style="color: #059669; font-weight: 600;"><i class="fas fa-check-circle me-2"></i>Email verification completed! Ready to vote.</div>';
    } else {
        document.getElementById('verificationMessage').innerHTML = 
            '<div style="color: #d97706; font-weight: 600;"><i class="fas fa-shield-alt me-2"></i>Please verify your email to enable voting.</div>';
    }
});

function startResendCountdown(seconds = 60) {
    resendCountdown = seconds;
    const resendBtn = document.getElementById('resendOtpBtn');
    const resendTimerEl = document.getElementById('resendTimer');
    const countdownEl = document.getElementById('countdown');
    
    resendBtn.disabled = true;
    resendTimerEl.style.display = 'block';
    
    resendTimer = setInterval(() => {
        resendCountdown--;
        countdownEl.textContent = resendCountdown;
        
        if (resendCountdown <= 0) {
            clearInterval(resendTimer);
            resendBtn.disabled = false;
            resendTimerEl.style.display = 'none';
            resendBtn.innerHTML = '<i class="fas fa-redo me-1"></i>Resend OTP';
        }
    }, 1000);
}

function resendOTP() {
    // Call the same function as initial send
    sendOTP();
}

function showCandidatesSection() {
    // Security check: Only proceed if email is verified in this session
    if (emailVerified) {
        console.log(' Email verified - ready for voting');
    } else {
        console.log(' Security: Access blocked - OTP verification required');
        showStatus('Please verify your email with OTP first.', 'warning');
    }
}

// Vote button functions removed - voting functionality has been disabled















function verifyOTP() {
    const otpCode = document.getElementById('otpInput').value;
    
    if (otpCode.length !== 6) {
        showOTPStatus('Please enter a complete 6-digit code.', 'error');
        return;
    }
    
    fetch('{% url "voting:voter_profile" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            action: 'verify_vote_otp',
            otp_code: otpCode
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showOTPStatus('Email verified successfully! ', 'success');
            emailVerified = true;
            
            // Close OTP modal first
            setTimeout(() => {
                closeOTPModal();
            }, 1000);
            
            // Show success message
            setTimeout(() => {
                showStatus(' Email verified successfully!', 'success');
            }, 1200);
            
            // Update verification message
            document.getElementById('verificationMessage').innerHTML = 
                '<div style="color: #059669; font-weight: 600;"><i class="fas fa-check-circle me-2"></i>Email verification completed! Ready to vote.</div>';
            
            // Show candidates section
            showCandidatesSection();
            

        } else {
            showOTPStatus(data.message, 'error');
            if (data.remaining_attempts !== undefined) {
                showOTPStatus(`${data.message} (${data.remaining_attempts} attempts remaining)`, 'error');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showOTPStatus('Verification failed. Please try again.', 'error');
    });
}





function closeOTPModal() {
    const modal = document.getElementById('otpModal');
    modal.classList.remove('show');
    modal.style.display = 'none';
    document.getElementById('otpInput').value = '';
    document.getElementById('otpStatusMessage').style.display = 'none';
    
    // Clear resend timer
    if (resendTimer) {
        clearInterval(resendTimer);
        resendTimer = null;
    }
    document.getElementById('resendTimer').style.display = 'none';
    document.getElementById('resendOtpBtn').disabled = false;
}

function showOTPModal() {
    // First send the OTP
    sendOTP();
    
    const modal = document.getElementById('otpModal');
    const otpInput = document.getElementById('otpInput');
    
    // Force display with inline styles
    modal.style.display = 'flex';
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
    modal.style.zIndex = '99999';
    modal.style.alignItems = 'center';
    modal.style.justifyContent = 'center';
    
    if (otpInput) {
        setTimeout(() => otpInput.focus(), 100);
    }
}

// Candidate selection functions
let selectedCandidate = null;

function showCandidatesSection() {
    const candidatesSection = document.getElementById('candidatesSection');
    if (candidatesSection) {
        candidatesSection.style.display = 'block';
        // Add show class with a slight delay for animation
        setTimeout(() => {
            candidatesSection.classList.add('show');
        }, 10);
        // Prevent background scrolling
        document.body.style.overflow = 'hidden';
    }
}

function hideCandidatesPopup() {
    const candidatesSection = document.getElementById('candidatesSection');
    if (candidatesSection) {
        candidatesSection.classList.remove('show');
        setTimeout(() => {
            candidatesSection.style.display = 'none';
            // Restore background scrolling
            document.body.style.overflow = '';
        }, 300);
    }
}

function selectCandidate(partyId, cardElement) {
    // Store the potential selection temporarily
    window.tempCandidateSelection = {
        partyId: partyId,
        cardElement: cardElement
    };
    
    // Get candidate name for popup
    const candidateName = cardElement.querySelector('.party-name').textContent.trim();
    
    // Show selection confirmation popup
    showCandidateSelectionPopup(candidateName);
}

function showCandidateSelectionPopup(candidateName) {
    // Create and show candidate selection popup
    const popup = document.createElement('div');
    popup.id = 'candidateSelectionPopup';
    popup.className = 'candidate-selection-popup';
    popup.innerHTML = `
        <div class="candidate-selection-popup-content">
            <div class="popup-icon">
                <i class="fas fa-vote-yea"></i>
            </div>
            <h3 class="popup-title">Select Your Candidate</h3>
            <p class="popup-message">Do you want to select this candidate for voting?</p>
            <div class="popup-candidate-name">${candidateName}</div>
            <p class="popup-instruction">Click "Yes, Select" to choose this candidate, or "Cancel" to choose a different candidate.</p>
            <div class="popup-buttons">
                <button class="popup-btn popup-btn-select" onclick="confirmCandidateSelection()">
                    <i class="fas fa-check me-2"></i>Yes, Select
                </button>
                <button class="popup-btn popup-btn-cancel" onclick="cancelCandidateSelection()">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(popup);
    
    // Show popup with animation
    setTimeout(() => {
        popup.classList.add('show');
    }, 10);
}

function closeCandidateSelectionPopup() {
    const popup = document.getElementById('candidateSelectionPopup');
    if (popup) {
        popup.classList.remove('show');
        setTimeout(() => {
            popup.remove();
        }, 300);
    }
}

function confirmCandidateSelection() {
    // Get the temporarily stored selection
    const tempSelection = window.tempCandidateSelection;
    if (!tempSelection) return;
    
    // Remove selection from all cards (both regular and popup)
    document.querySelectorAll('.candidate-card, .candidate-card-popup').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selection to confirmed card
    tempSelection.cardElement.classList.add('selected');
    selectedCandidate = tempSelection.partyId;
    
    // Close the candidate selection popup
    closeCandidateSelectionPopup();
    
    // Show vote button
    const voteButton = document.getElementById('voteButton');
    if (voteButton) {
        voteButton.style.display = 'block';
        voteButton.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Show success message
    showStatus('Candidate selected! You can now cast your vote.', 'success');
    
    // Clear temporary selection
    window.tempCandidateSelection = null;
}

function cancelCandidateSelection() {
    // Close the popup without selecting
    closeCandidateSelectionPopup();
    
    // Clear temporary selection
    window.tempCandidateSelection = null;
    
    // Show info message
    showStatus('Selection cancelled. Please choose your candidate.', 'info');
}

function submitVote() {
    if (!selectedCandidate) {
        showStatus('Please select a candidate before voting.', 'error');
        return;
    }
    
    // Get the selected candidate name (works for both popup and regular cards)
    const selectedCard = document.querySelector('.candidate-card.selected, .candidate-card-popup.selected');
    const candidateName = selectedCard ? selectedCard.querySelector('.party-name').textContent.trim() : 'Selected Candidate';
    
    // Update the confirmation modal with candidate info
    document.getElementById('selectedCandidateName').textContent = candidateName;
    
    // Hide candidates popup if it's open
    hideCandidatesPopup();
    
    // Show the custom confirmation modal
    showConfirmationModal();
}

function showConfirmationModal() {
    const modal = document.getElementById('confirmationModal');
    modal.classList.add('show');
    
    // Prevent background scrolling
    document.body.style.overflow = 'hidden';
}

function hideConfirmationModal() {
    const modal = document.getElementById('confirmationModal');
    modal.classList.remove('show');
    
    // Restore background scrolling
    document.body.style.overflow = '';
}

function confirmVote() {
    hideConfirmationModal();
    
    // Proceed with the actual vote submission
    fetch('{% url "voting:voter_profile" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            action: 'submit_vote',
            party_id: selectedCandidate
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success modal with blockchain details
            showVoteSuccessModal(data);
            
            // Disable further voting
            document.querySelectorAll('.candidate-card, .candidate-card-popup').forEach(card => {
                card.style.pointerEvents = 'none';
                card.style.opacity = '0.6';
            });
            document.getElementById('voteButton').style.display = 'none';
            
            console.log('Full vote response:', data);
        } else {
            showStatus(data.message || 'Failed to submit vote. Please try again.', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showStatus('An error occurred while submitting your vote.', 'error');
    });
}

function cancelVote() {
    hideConfirmationModal();
}

function showVoteSuccessModal(data) {
    // Get candidate name
    const selectedCard = document.querySelector('.candidate-card.selected');
    const candidateName = selectedCard ? selectedCard.querySelector('.party-name').textContent.trim() : 'Selected Candidate';
    
    // Create success modal
    const modal = document.createElement('div');
    modal.id = 'voteSuccessModal';
    modal.className = 'vote-success-modal';
    
    let blockchainInfo = '';
    if (data.blockchain_hash) {
        blockchainInfo = `
            <div class="blockchain-details">
                <div class="blockchain-title">
                    <i class="fas fa-link me-2"></i>Blockchain Transaction Details
                </div>
                <div class="blockchain-hash">
                    <strong>Transaction Hash:</strong>
                    <div class="hash-value">${data.blockchain_hash}</div>
                </div>
                ${data.blockchain_message ? `<div class="blockchain-status">${data.blockchain_message}</div>` : ''}
            </div>
        `;
    }
    
    modal.innerHTML = `
        <div class="vote-success-modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="success-title">Vote Successfully Cast!</h2>
            <div class="voted-candidate">
                <p class="success-message">You have successfully voted for:</p>
                <div class="candidate-name-display">${candidateName}</div>
            </div>
            
            ${blockchainInfo}
            
            <div class="success-features">
                <div class="feature-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secured on Blockchain</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-lock"></i>
                    <span>Immutable & Transparent</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-check-double"></i>
                    <span>Verified & Counted</span>
                </div>
            </div>
            
            <div class="success-buttons">
                <button class="success-btn" onclick="closeVoteSuccessModal()">
                    <i class="fas fa-check me-2"></i>Close
                </button>
                <button class="success-btn secondary" onclick="viewResults()">
                    <i class="fas fa-chart-bar me-2"></i>View Results
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Show modal with animation
    setTimeout(() => {
        modal.classList.add('show');
    }, 10);
    
    // Prevent background scrolling
    document.body.style.overflow = 'hidden';
}

function closeVoteSuccessModal() {
    const modal = document.getElementById('voteSuccessModal');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.remove();
            document.body.style.overflow = '';
        }, 300);
    }
}

function viewResults() {
    window.location.href = '{% url "voting:results" %}';
}

// Close modal when clicking outside of it
document.addEventListener('click', function(event) {
    const modal = document.getElementById('confirmationModal');
    if (event.target === modal) {
        hideConfirmationModal();
    }
    
    // Also handle candidate selection popup
    const candidatePopup = document.getElementById('candidateSelectionPopup');
    if (event.target === candidatePopup) {
        cancelCandidateSelection();
    }
    
    // Handle vote success modal
    const successModal = document.getElementById('voteSuccessModal');
    if (event.target === successModal) {
        closeVoteSuccessModal();
    }
    
    // Handle candidates popup backdrop
    const candidatesPopup = document.getElementById('candidatesSection');
    if (candidatesPopup && event.target.classList.contains('candidates-popup-backdrop')) {
        hideCandidatesPopup();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        // Check which modal is open and close it
        const confirmationModal = document.getElementById('confirmationModal');
        const candidatePopup = document.getElementById('candidateSelectionPopup');
        const successModal = document.getElementById('voteSuccessModal');
        const candidatesPopup = document.getElementById('candidatesSection');
        
        if (candidatePopup && candidatePopup.classList.contains('show')) {
            cancelCandidateSelection();
        } else if (candidatesPopup && candidatesPopup.classList.contains('show')) {
            hideCandidatesPopup();
        } else if (confirmationModal && confirmationModal.classList.contains('show')) {
            hideConfirmationModal();
        } else if (successModal && successModal.classList.contains('show')) {
            closeVoteSuccessModal();
        }
    }
});

function sendOTP() {
    // Send OTP for email verification
    fetch('{% url "voting:voter_profile" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            action: 'send_vote_otp'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.emailjs_config) {
            // Use EmailJS to send the actual email
            const emailjsConfig = data.emailjs_config;
            
            // Initialize EmailJS with the public key from config
            try {
                emailjs.init(emailjsConfig.public_key);
                console.log('EmailJS initialized with public key:', emailjsConfig.public_key);
            } catch (initError) {
                console.error('EmailJS initialization failed:', initError);
                showStatus('Failed to initialize email service.', 'error');
                return;
            }
            
            emailjs.send(
                emailjsConfig.service_id,
                emailjsConfig.template_id,
                emailjsConfig.template_params
            ).then(function(response) {
                console.log('EmailJS SUCCESS!', response.status, response.text);
                showStatus('OTP sent successfully to your email!', 'success');
                otpSent = true;
                // Start resend countdown
                startResendCountdown(60);
            }, function(error) {
                console.log('EmailJS FAILED...', error);
                showStatus('Failed to send OTP email. Please try again.', 'error');
            });
        } else {
            showStatus('Error sending OTP: ' + (data.message || 'Unknown error'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showStatus('An error occurred while sending OTP.', 'error');
    });
}

function changeEmail() {
    // This would typically open a modal to change email
    // For now, just show a message
    showStatus('Email change functionality will be implemented soon.', 'warning');
}

function showStatus(message, type) {
    const statusEl = document.getElementById('statusMessage');
    statusEl.className = `status-message status-${type}`;
    statusEl.textContent = message;
    statusEl.style.display = 'block';
    
    if (type === 'success') {
        setTimeout(() => {
            statusEl.style.display = 'none';
        }, 5000);
    }
}

function showOTPStatus(message, type) {
    const statusEl = document.getElementById('otpStatusMessage');
    statusEl.className = `status-message status-${type}`;
    statusEl.textContent = message;
    statusEl.style.display = 'block';
}

// Auto-format OTP input
document.getElementById('otpInput').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 6) value = value.slice(0, 6);
    e.target.value = value;
    
    if (value.length === 6) {
        // Auto-verify when 6 digits are entered
        setTimeout(() => verifyOTP(), 500);
    }
});

// Close modal when clicking outside
document.getElementById('otpModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeOTPModal();
    }
});

// Profile picture loading and error handling
document.addEventListener('DOMContentLoaded', function() {
    const profileImg = document.querySelector('.voter-photo img');
    const profileContainer = document.querySelector('.voter-photo');
    
    if (profileImg) {
        console.log('Profile picture found:', profileImg.src);
        
        profileImg.addEventListener('load', function() {
            console.log(' Profile picture loaded successfully:', this.src);
            this.classList.remove('loading');
        });
        
        profileImg.addEventListener('error', function() {
            console.log(' Profile picture failed to load:', this.src);
            console.log('Attempting to show placeholder...');
            
            this.style.display = 'none';
            
            // Find and show the placeholder
            const placeholder = profileContainer.querySelector('.voter-photo-placeholder[style*="display: none"]');
            if (placeholder) {
                placeholder.style.display = 'flex';
                console.log(' Placeholder shown');
            } else {
                console.log(' No placeholder found');
                // Create a new placeholder if none exists
                const newPlaceholder = document.createElement('i');
                newPlaceholder.className = 'fas fa-user voter-photo-placeholder';
                newPlaceholder.title = 'Profile picture not available';
                profileContainer.appendChild(newPlaceholder);
                console.log(' New placeholder created');
            }
        });
        
        // Add loading class initially
        profileImg.classList.add('loading');
        
        // Log debug info
        const debugInfo = document.querySelector('.voter-photo div[style*="display: none"]');
        if (debugInfo) {
            console.log('Profile picture debug info:', debugInfo.textContent);
        }
    } else {
        console.log(' No profile picture found - showing placeholder by default');
    }
});
</script>

{% csrf_token %}
{% endblock %}
